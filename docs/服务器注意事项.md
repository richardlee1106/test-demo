# GeoLoom-RAG æœåŠ¡å™¨ä¸æ•°æ®åº“ç»´æŠ¤æ‰‹å†Œ (v4.0)

## ğŸ“Œ æ ¸å¿ƒç¯å¢ƒè¯´æ˜

* **åŸºç¡€é•œåƒ**: `kartoza/postgis:16-3.4` (è‡ªå®šä¹‰æ„å»º)
* **å…³é”®ç»„ä»¶**: `pgvector` (å‘é‡æ‰©å±•)ã€`h3-js` (å…­è¾¹å½¢ç´¢å¼•)ã€`PostGIS 3.4`
* **æ•°æ®é‡**: 845,676 æ¡ POI åŠ 1:1 é…å¥—çš„å‘é‡æ•°æ®ã€‚

## âš ï¸ æ•°æ®åº“è¿ç»´çº¢çº¿ (åˆ‡è®°ï¼)

1. **ç¦å¿Œæ“ä½œ**: ä¸¥ç¦åœ¨ç”Ÿäº§ç¯å¢ƒæ— å¤‡ä»½æ—¶æ‰§è¡Œ `DROP TABLE`ã€‚
2. **å¯åŠ¨è‡ªæ£€**: åç«¯åœ¨å¯åŠ¨æ—¶ä¼šæ£€æŸ¥ `vector` æ‰©å±•å’Œ `pois` è¡¨ï¼Œå¦‚æœæŠ¥é”™ï¼Œè¯·æ£€æŸ¥è‡ªå®šä¹‰ Docker é•œåƒæ˜¯å¦åŒ…å« `pgvector` æ’ä»¶ã€‚
3. **Peer è®¤è¯é—®é¢˜**:
    åœ¨æœåŠ¡å™¨é€šè¿‡ `docker exec` æ‰§è¡Œ SQL æ—¶ï¼Œè‹¥æŠ¥ `Peer authentication failed`ï¼Œ**å¿…é¡»**å¢åŠ å‚æ•° `-h 127.0.0.1` (æˆ– `localhost`) æ¥å¼ºåˆ¶å¯ç”¨å¯†ç è®¤è¯æ¨¡å¼ã€‚

## ğŸ’¾ å¤‡ä»½ä¸æ¢å¤æ ‡å‡†æ“ä½œ

### å¤‡ä»½æµç¨‹

å»ºè®®æ¯å‘¨å¤‡ä»½ä¸€æ¬¡å¹¶ä¸Šä¼ è‡³äº‘ç«¯ï¼š

```bash
# å¯¼å‡º Docker å†…çš„æ•°æ®åº“ (å‹ç¼©æ ¼å¼)
docker exec -i geoloom-spatial-db pg_dump -h localhost -U postgres -d geoloom -F c > /mnt/data/geoloom_$(date +%Y%m%d).dump

# å¦‚æœä¸Šä¼ ç™¾åº¦äº‘å¤±è´¥ï¼Œè¯·ä½¿ç”¨ split æ‹†åˆ†
split -b 500M /mnt/data/geoloom_V16_SERVER_BACKUP.dump /mnt/data/geoloom_part_
bypy upload /mnt/data/geoloom_part_*
```

### æ¢å¤æµç¨‹ (ä¸‡æ— ä¸€å¤±ç‰ˆ)

```bash
# --clean: è‡ªåŠ¨æ¸…ç†æ—§æ•°æ®é‡æ–°å¼€å§‹
# --no-owner: å¿½ç•¥åŸå¤‡ä»½çš„ç”¨æˆ·æƒé™ï¼Œè§£å†³å¯¼å…¥æƒé™å†²çª
docker exec -i -e PGPASSWORD=ä½ çš„å¯†ç  geoloom-spatial-db pg_restore -h 127.0.0.1 -U postgres -d geoloom --clean --if-exists --no-owner --no-privileges -v < å¤‡ä»½æ–‡ä»¶.dump
```

## ğŸ¤– åç«¯/AI æ¨¡å—æ³¨æ„äº‹é¡¹

* **H3 ç´¢å¼•**: åœ°ç†æ„ŸçŸ¥åˆ†æå·²åˆ‡æ¢ä¸º H3 èšåˆï¼Œå–ä»£äº†æ—§çš„ Geohashã€‚è‹¥å‡ºç°åæ ‡æ— æ•ˆè­¦å‘Šï¼Œè¯·æ£€æŸ¥å‰ç«¯ä¼ å‚æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„ `spatialContext`ã€‚
* **æ¨¡å‹è‡ªæ£€**: `services/llm.js` ä¼šè‡ªåŠ¨æ£€æµ‹æœ¬åœ° LM Studio ä¸­åŠ è½½çš„æ¨¡å‹åï¼Œæ— éœ€æ‰‹åŠ¨ç¡¬ç¼–ç ã€‚
* **æ¸…ç†å»ºè®®**: ç¯å¢ƒè·‘é€šåï¼Œ`/mnt/data/` ç›®å½•ä¸‹çš„ `geoloom_RESCUE.7z` å’Œ `postgis_image.tar` å±äºæ„å»ºä¸­è½¬æ–‡ä»¶ï¼Œå‡å¯åˆ é™¤ä»¥é‡Šæ”¾ç©ºé—´ã€‚

---
ğŸ“ *ç»´æŠ¤è®°å½•ï¼š2026-01-17 æˆåŠŸä¿®å¤ pgvector ç¯å¢ƒä¸­æ–­å¹¶æ¢å¤ 84w æ•°æ®ã€‚*
